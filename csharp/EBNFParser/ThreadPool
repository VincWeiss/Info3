using System;
using System.Threading;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;
using System.Collections;

namespace ConsoleApplication4
{

    class TPool
    {
        private System.IO.StreamReader file =
        new System.IO.StreamReader("D:\\expressions.txt");
        int QueueLength;

        public TPool()
        {
            QueueLength = 0;
        }

        public void addTaskToQueue(TPool poolObj, String lineToParse)
        {
            ThreadPool.QueueUserWorkItem(
            o => parseLine(lineToParse));
            QueueLength++;
        }



        ArrayList getTxt()
        {
            ArrayList lineList = new ArrayList();
            string completeText = file.ReadToEnd();
            string[] lines = completeText.Split('\n');
            foreach (String tempString in lines)
            {
                lineList.Add(tempString);
            }

            lineList.TrimToSize();
            return lineList;
        }

        public void parseLine(String lineToParse)
        {
            Thread.Sleep(1000);
            EBNFParser parserObject = new EBNFParser();
            parserObject.parse(lineToParse, parserObject);
            Thread.Sleep(1000);
            QueueLength--;
        }

        public static void Main(String[] args)
        {
            int counter = 0;
            TPool tPoolObj = new TPool();
            ThreadPool.SetMaxThreads(1, 1);
            ArrayList lineList = tPoolObj.getTxt();
            foreach (String line in lineList)
            {
                tPoolObj.addTaskToQueue(tPoolObj, line);
                counter++;
            }
            while (tPoolObj.QueueLength != 0 || tPoolObj.QueueLength < 0)
            {
                Thread.Sleep(1000);
            }

        }
    }

}
