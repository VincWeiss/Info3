using System;
using System.Threading;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;
using System.Collections;

namespace ConsoleApplication4
{
    /* in this class the text file is read, the threadpools get their task*/ 
    class TPool
    {
        private System.IO.StreamReader file =
        new System.IO.StreamReader("D:\\expressions.txt");
        int QueueLength;
        
        //constructor of ThreadPool class, sets the initial queue length
        public TPool()
        {
            QueueLength = 0;
        }
        
        //@param Tpool poolObj, String lineToParse
        //assigns the tasks to the threadpool
        public void addTaskToQueue(TPool poolObj, String lineToParse)
        {
            ThreadPool.QueueUserWorkItem(
            o => parseLine(lineToParse));
            QueueLength++;
        }

        //reads the Text file and makes strings out of it. 
        //@return ArrayList lineList, it contains the lines
        ArrayList getTxt()
        {
            ArrayList lineList = new ArrayList();
            string completeText = file.ReadToEnd();
            string[] lines = completeText.Split('\n');
            foreach (String tempString in lines)
            {
                lineList.Add(tempString);
            }

            lineList.TrimToSize();
            return lineList;
        }
        
        //@param String lineToParse
        //creates a new parser object for each thread in threadpool and execute 
        //the task given
        public void parseLine(String lineToParse)
        {
            Thread.Sleep(1000);
            EBNFParser parserObject = new EBNFParser();
            parserObject.parse(lineToParse, parserObject);
            Thread.Sleep(1000);
            QueueLength--;
        }
        
        //to comment
        public static void Main(String[] args)
        {
            int counter = 0;
            TPool tPoolObj = new TPool();
            ThreadPool.SetMaxThreads(1, 1);
            ArrayList lineList = tPoolObj.getTxt();
            foreach (String line in lineList)
            {
                tPoolObj.addTaskToQueue(tPoolObj, line);
                counter++;
            }
            while (tPoolObj.QueueLength != 0 || tPoolObj.QueueLength < 0)
            {
                Thread.Sleep(1000);
            }
        }
    }
} // end of class
